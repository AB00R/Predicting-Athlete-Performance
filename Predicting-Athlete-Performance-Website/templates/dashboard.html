<!-- dashboard.html -->

{% extends "base.html" %}

{% block page_title %}
    {% if active_page == 'overview' %}
        Overview
    {% elif active_page == 'schedule' %}
        Schedule Details
    {% elif active_page == 'predictions' %}
        Predicted Risk & Injury
    {% elif active_page == 'history' %}
        History/Logs
    {% elif active_page == 'settings' %}
        Settings
    {% endif %}
{% endblock %}

{% block content %}
    {% if active_page == 'overview' %}
        <div class="overview-container">
            <div class="overview-header">
                <h3>Athlete Performance Dashboard</h3>
                <div class="date-filter">
                    <span>Date Range:</span>
                    <select id="timeRangeSelector">
                        <option value="7">Last 7 Days</option>
                        <option value="14">Last 14 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 3 Months</option>
                    </select>
                </div>
            </div>
            
            <!-- Training Intensity vs Performance Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h4>Training Intensity vs Performance</h4>
                    <div class="chart-actions">
                        <button class="chart-action-btn" id="downloadIntensityChart">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="chart-action-btn" id="refreshIntensityChart">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="intensityVsPerformanceChart"></canvas>
                </div>
            </div>
            
            <!-- Predictions Section Title -->
            <div class="section-title">
                <h4>Today's Predicted Metrics</h4>
                <span class="date-subtitle">{{ current_date }}</span>
            </div>
            
            <!-- Predictions Grid -->
            <div class="predictions-grid">
                <!-- Injury Risk Prediction -->
                <div class="prediction-card">
                    <div class="prediction-header">
                        <h4>Injury Risk</h4>
                        <span class="metric-badge low">Low</span>
                    </div>
                    <div class="chart-container donut-container">
                        <canvas id="injuryRiskChart"></canvas>
                    </div>
                    <div class="prediction-footer">
                        <div class="prediction-metric">
                            <span class="metric-value" id="injuryRiskValue">24%</span>
                            <span class="metric-label">Current Risk</span>
                        </div>
                        <div class="prediction-change">
                            <span class="change-label decrease">↓ 3%</span>
                            <span class="change-period">from yesterday</span>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Prediction -->
                <div class="prediction-card">
                    <div class="prediction-header">
                        <h4>Performance</h4>
                        <span class="metric-badge high">High</span>
                    </div>
                    <div class="chart-container donut-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                    <div class="prediction-footer">
                        <div class="prediction-metric">
                            <span class="metric-value" id="performanceValue">83%</span>
                            <span class="metric-label">Optimal Level</span>
                        </div>
                        <div class="prediction-change">
                            <span class="change-label increase">↑ 2%</span>
                            <span class="change-period">from yesterday</span>
                        </div>
                    </div>
                </div>
                
                <!-- Fatigue Prediction -->
                <div class="prediction-card">
                    <div class="prediction-header">
                        <h4>Fatigue</h4>
                        <span class="metric-badge medium">Medium</span>
                    </div>
                    <div class="chart-container donut-container">
                        <canvas id="fatigueChart"></canvas>
                    </div>
                    <div class="prediction-footer">
                        <div class="prediction-metric">
                            <span class="metric-value" id="fatigueValue">41%</span>
                            <span class="metric-label">Current Level</span>
                        </div>
                        <div class="prediction-change">
                            <span class="change-label decrease">↓ 5%</span>
                            <span class="change-period">from yesterday</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% elif active_page == 'schedule' %}
        <div class="schedule-container">
            <div class="schedule-header">
                <h3>Training Schedule & Analytics</h3>
                <div class="date-filter">
                    <span>Date Range:</span>
                    <select id="scheduleTimeRangeSelector">
                        <option value="7">Last 7 Days</option>
                        <option value="14">Last 14 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 3 Months</option>
                    </select>
                </div>
            </div>
            
            <!-- Multi-line Performance Metrics Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h4>Combined Performance Metrics</h4>
                    <div class="chart-actions">
                        <button class="chart-action-btn" id="downloadScheduleChart">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="chart-action-btn" id="refreshScheduleChart">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="combinedMetricsChart"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #4F7942;"></span>
                        <span class="legend-label">Training Intensity</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #2196F3;"></span>
                        <span class="legend-label">Performance Level</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #F44336;"></span>
                        <span class="legend-label">Injury Risk</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #FFC107;"></span>
                        <span class="legend-label">Fatigue</span>
                    </div>
                </div>
            </div>
            
            <!-- Risk Level Heat Map -->
            <div class="chart-card">
                <div class="chart-header">
                    <h4>Risk Level Heat Map</h4>
                    <div class="chart-info">
                        <span class="info-icon" data-tooltip="Shows injury risk patterns across days">
                            <i class="fas fa-info-circle"></i>
                        </span>
                    </div>
                </div>
                <div class="heatmap-wrapper">
                    <div class="heatmap-container" id="riskHeatmap">
                        <!-- Heatmap will be rendered here by JavaScript -->
                    </div>
                </div>
                <div class="heatmap-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(79, 121, 66, 0.2);"></div>
                        <span>Low Risk (0-0.3)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(79, 121, 66, 0.4);"></div>
                        <span>Moderate Risk (0.3-0.6)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(79, 121, 66, 0.6);"></div>
                        <span>High Risk (0.6-0.8)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: rgba(79, 121, 66, 0.8);"></div>
                        <span>Critical Risk (0.8-1.0)</span>
                    </div>
                </div>
            </div>
            
            <!-- Detailed Metrics Table -->
            <div class="chart-card table-card">
                <div class="chart-header">
                    <h4>Detailed Daily Metrics</h4>
                    <div class="table-actions">
                        <button class="chart-action-btn" id="exportTableData">
                            <i class="fas fa-file-export"></i>
                            <span class="tooltip-text">Export Data</span>
                        </button>
                        <button class="chart-action-btn" id="refreshTableData">
                            <i class="fas fa-sync-alt"></i>
                            <span class="tooltip-text">Refresh Data</span>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table id="metricsTable" class="metrics-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Training Intensity (%)</th>
                                <th>Performance (%)</th>
                                <th>Injury Risk (%)</th>
                                <th>Fatigue (%)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Table data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls">
                    <button id="prevPage" class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                    <span id="pageIndicator">Page 1 of 1</span>
                    <button id="nextPage" class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    {% elif active_page == 'predictions' %}
        <div class="predictions-container">
            <div class="predictions-header">
                <h3>Injury Risk & Fatigue Prediction Analysis</h3>
                <div class="date-filter">
                    <span>Time Horizon:</span>
                    <select id="predictionTimeSelector">
                        <option value="7">Next 7 Days</option>
                        <option value="14">Next 14 Days</option>
                        <option value="30">Next 30 Days</option>
                    </select>
                </div>
            </div>
            
            <!-- Prediction Time Series Charts -->
            <div class="predictions-grid">
                <!-- Injury Risk Prediction Chart -->
                <div class="chart-card prediction-chart-card">
                    <div class="chart-header">
                        <h4>Predicted Injury Risk</h4>
                        <div class="risk-level high">High Risk Period</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="injuryRiskPredictionChart"></canvas>
                    </div>
                    <div class="chart-footer">
                        <div class="risk-summary">
                            <div class="risk-metric">
                                <span class="risk-value" id="currentRiskValue">32%</span>
                                <span class="risk-label">Current Risk</span>
                            </div>
                            <div class="risk-metric">
                                <span class="risk-value" id="peakRiskValue">48%</span>
                                <span class="risk-label">Peak Risk</span>
                            </div>
                            <div class="risk-metric">
                                <span class="risk-value" id="avgRiskValue">27%</span>
                                <span class="risk-label">Average Risk</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Fatigue Prediction Chart -->
                <div class="chart-card prediction-chart-card">
                    <div class="chart-header">
                        <h4>Predicted Fatigue Level</h4>
                        <div class="fatigue-level medium">Moderate Fatigue</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="fatiguePredictionChart"></canvas>
                    </div>
                    <div class="chart-footer">
                        <div class="fatigue-summary">
                            <div class="fatigue-metric">
                                <span class="fatigue-value" id="currentFatigueValue">45%</span>
                                <span class="fatigue-label">Current Level</span>
                            </div>
                            <div class="fatigue-metric">
                                <span class="fatigue-value" id="peakFatigueValue">67%</span>
                                <span class="fatigue-label">Peak Level</span>
                            </div>
                            <div class="fatigue-metric">
                                <span class="fatigue-value" id="avgFatigueValue">38%</span>
                                <span class="fatigue-label">Average Level</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Relationship Analysis Section -->
            <div class="section-title">
                <h4>Training Impact Analysis</h4>
                <span class="section-subtitle">Understanding relationships between training and risk factors</span>
            </div>
            
            <div class="relationship-grid">
                <!-- Training Intensity vs Injury Risk -->
                <div class="chart-card relationship-card">
                    <div class="chart-header">
                        <h4>Training Intensity vs Injury Risk</h4>
                        <div class="chart-info">
                            <span class="info-icon" data-tooltip="Shows how training intensity correlates with injury risk">
                                <i class="fas fa-info-circle"></i>
                            </span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="intensityVsRiskChart"></canvas>
                    </div>
                    <div class="insight-box">
                        <div class="insight-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="insight-text">
                            <strong>Key Insight:</strong> <span id="riskInsight">Risk increases significantly when intensity exceeds 75% for 3+ consecutive days.</span>
                        </div>
                    </div>
                </div>
                
                <!-- Training Intensity vs Fatigue -->
                <div class="chart-card relationship-card">
                    <div class="chart-header">
                        <h4>Training Intensity vs Fatigue</h4>
                        <div class="chart-info">
                            <span class="info-icon" data-tooltip="Shows how training intensity affects fatigue levels">
                                <i class="fas fa-info-circle"></i>
                            </span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="intensityVsFatigueChart"></canvas>
                    </div>
                    <div class="insight-box">
                        <div class="insight-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="insight-text">
                            <strong>Key Insight:</strong> <span id="fatigueInsight">Fatigue accumulates most rapidly with high intensity workouts on consecutive days with limited recovery.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% elif active_page == 'history' %}
        <div class="history-container">
            <div class="history-header">
                <h3>Activity History & Algorithm Logs</h3>
                <div class="date-filter">
                    <span>View Mode:</span>
                    <select id="historyViewSelector">
                        <option value="grid">Grid View</option>
                        <option value="list">List View</option>
                        <option value="timeline">Timeline View</option>
                    </select>
                </div>
            </div>
            
            <!-- Grid View of History -->
            <div class="history-grid-view">
                <div class="grid-controls">
                    <button class="grid-nav-btn" id="prevGridList"><i class="fas fa-chevron-left"></i></button>
                    <h4 id="currentGridDisplay">List 1</h4>
                    <button class="grid-nav-btn" id="nextGridList"><i class="fas fa-chevron-right"></i></button>
                </div>
                
                <div class="log-grid">
                    <!-- JS will populate grid items here -->
                </div>
                
                <div class="grid-legend">
                    <div class="legend-title">Algorithm Types:</div>
                    <div class="legend-item">
                        <div class="legend-dot astar"></div>
                        <span>A* Search</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot bfs"></div>
                        <span>BFS Search</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot dfs"></div>
                        <span>DFS Search</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot genetic"></div>
                        <span>Genetic Algorithm</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot csp"></div>
                        <span>CSP Solver</span>
                    </div>
                </div>
                
                <div class="grid-pagination">
                    <button id="prevGridPage" class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                    <span id="gridPageIndicator">Page 1 of 3</span>
                    <button id="nextGridPage" class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <!-- Recent Activities List View (initially hidden, toggled by viewSelector) -->
            <div class="history-list-view" style="display: none;">
                <div class="history-list-header">
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label>Algorithm Type:</label>
                            <select id="algorithmTypeFilter">
                                <option value="all">All Types</option>
                                <option value="astar">A* Search</option>
                                <option value="bfs">BFS Search</option>
                                <option value="dfs">DFS Search</option>
                                <option value="genetic">Genetic Algorithm</option>
                                <option value="csp">CSP Solver</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Date Range:</label>
                            <select id="dateRangeFilter">
                                <option value="7">Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 3 months</option>
                                <option value="all">All time</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="history-list">
                    <!-- JS will populate history items here -->
                </div>
                
                <div class="pagination-controls">
                    <button id="prevLogPage" class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                    <span id="logPageIndicator">Page 1 of 3</span>
                    <button id="nextLogPage" class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
        
        <!-- Log Details Modal/Popup -->
        <div class="modal" id="logDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="modalTitle">Edit/Search Log Details</h4>
                    <button class="close-modal-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="log-summary">
                        <div class="log-info-grid">
                            <div class="log-info-item">
                                <div class="info-label">Algorithm</div>
                                <div class="info-value" id="logAlgorithm"></div>
                            </div>
                            <div class="log-info-item">
                                <div class="info-label">Date & Time</div>
                                <div class="info-value" id="logDateTime"></div>
                            </div>
                            <div class="log-info-item">
                                <div class="info-label">Parameters</div>
                                <div class="info-value" id="logParams"></div>
                            </div>
                            <div class="log-info-item">
                                <div class="info-label">Summary</div>
                                <div class="info-value" id="logSummary"></div>
                            </div>
                        </div>
                    </div>
                    <div class="log-details-section">
                        <h5>Results</h5>
                        <div class="table-container">
                            <table class="metrics-table" id="logResultsTable">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Intensity</th>
                                        <th>Performance</th>
                                        <th>Risk</th>
                                        <th>Fatigue</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Results will be loaded by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="exportLogBtn" class="btn-primary">
                        <i class="fas fa-file-export"></i> Export Log
                    </button>
                </div>
            </div>
        </div>
    {% elif active_page == 'settings' %}
        <div class="settings-container">
            <h3>User Settings</h3>
            <div class="settings-form">
                <!-- Settings form placeholder -->
                <p>Settings options will be displayed here</p>
            </div>
        </div>
    {% endif %}
{% endblock %}